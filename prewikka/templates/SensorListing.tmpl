#extends prewikka.templates.ClassicLayout

#block main_content
#filter CleanOutput

#if len($analyzers) > 0
  <form action="?" method="post">
  <input type="hidden" name="view" value="sensor_messages_delete" />
#end if
<table>
  <thead>
    <tr>
      <td>$_("Name")</td>
      <td>$_("Model")</td>
      <td>$_("OS")</td>
      <td>$_("Node name")</td>
      <td>$_("Node location")</td>
      <td>$_("Node address")</td>
      <td>$_("Last heartbeat")</td>
      <td>$_("Latest status")</td>
    </tr>
  </thead>
  <tbody>
  #if len($analyzers) > 0
    #set $row_classes = ("table_row_even", "table_row_odd")
    #set $cnt = 0
    #set $rcnt = 0

    #for $analyzer in $analyzers
      #set $row_class = $row_classes[$rcnt%2]
      <tr class="$row_class">
        <td>
	  <a href="#" onclick="javascript:toggleVisibilityUnique('menu_$cnt'); return false;">$analyzer.name</a>
	  <span id="menu_$cnt" class="popup_menu">
            - <a href="$analyzer.alert_listing">$_("Alert listing")</a><br />
            - <a href="$analyzer.heartbeat_listing">$_("Heartbeat listing")</a><br />
            - <a href="$analyzer.heartbeat_analyze">$_("Heartbeat analysis")</a><br />
          </span>
        </td>
        <td>$analyzer.model $analyzer.version</td>
        <td>$analyzer.ostype $analyzer.osversion</td>

	#if $analyzer.node_name
         <td><a href="$analyzer.node_name_link">$analyzer.node_name</a></td>
        #else
         <td>n/a</td>
        #end if

	#if $analyzer.node_location
         <td><a href="$analyzer.node_location_link">$analyzer.node_location</a></td>
        #else
         <td>n/a</td>
        #end if

        <td>
        #if len($analyzer.node_addresses) > 0
          #for $address in $analyzer.node_addresses
           #set $cnt += 1

	   <a href="#" onclick="javascript:toggleVisibilityUnique('menu_$cnt'); return false;">$address.value</a><br />
           <span id="menu_$cnt" class="popup_menu">

            - <a href="$address.inline_filter">$_("Filter on address")</a><br />
            - <a target="$prewikka.external_link_target" href="https://www.prelude-ids.com/host_details.php?host=$address.value">$_("Address information")</a><br />
     
	    #for $name, $link in $address.host_commands
            - <a href="$link">$name</a><br />
            #end for
           </span>

          #end for
        #else
          n/a
        #end if
        </td>
        <td>$analyzer.last_heartbeat_time</td>
        <td class="heartbeat_analyze_sensor_status_$analyzer.status"><b>$analyzer.status_meaning</b></td>
        <td><input class="checkbox" type="checkbox" name="analyzerid" value="$analyzer.analyzerid" /></td>
      </tr>
      #set $rcnt += 1
      #set $cnt += 1
    #end for
  #else
    <tr><td class="not_available" style="text-align: center;" colspan="9">$_("No agent available")</td></tr>
  #end if
  </tbody>
</table>

<br/>

#if len($analyzers) > 0
  <div style="text-align: right; vertical-align: bottom;">
    <input class="checkbox" type="checkbox" name="alerts" /><b>$_("Alerts")</b>
    <input class="checkbox" type="checkbox" name="heartbeats" /><b>$_("Heartbeats")</b>
    &nbsp;<input type="submit" value="$_("Delete")" />
  </div>
#end if

</form>

#end filter
#end block main_content
